var de=Object.defineProperty,fe=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var V=(o,e,t)=>e in o?de(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,m=(o,e)=>{for(var t in e||(e={}))he.call(e,t)&&V(o,t,e[t]);if(q)for(var t of q(e))pe.call(e,t)&&V(o,t,e[t]);return o},W=(o,e)=>fe(o,ge(e));var me=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports);var C=(o,e,t)=>(V(o,typeof e!="symbol"?e+"":e,t),t);var E=(o,e,t)=>new Promise((r,s)=>{var n=f=>{try{c(t.next(f))}catch(a){s(a)}},l=f=>{try{c(t.throw(f))}catch(a){s(a)}},c=f=>f.done?r(f.value):Promise.resolve(f.value).then(n,l);c((t=t.apply(o,e)).next())});import{r as x,a as xe,R as ye}from"./vendor-3371026b.js";var He=me($=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();var Z={exports:{}},T={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var we=x,be=Symbol.for("react.element"),ve=Symbol.for("react.fragment"),Ie=Object.prototype.hasOwnProperty,Re=we.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ke={key:!0,ref:!0,__self:!0,__source:!0};function Q(o,e,t){var r,s={},n=null,l=null;t!==void 0&&(n=""+t),e.key!==void 0&&(n=""+e.key),e.ref!==void 0&&(l=e.ref);for(r in e)Ie.call(e,r)&&!ke.hasOwnProperty(r)&&(s[r]=e[r]);if(o&&o.defaultProps)for(r in e=o.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:be,type:o,key:n,ref:l,props:s,_owner:Re.current}}T.Fragment=ve;T.jsx=Q;T.jsxs=Q;Z.exports=T;var i=Z.exports,B={},H=xe;B.createRoot=H.createRoot,B.hydrateRoot=H.hydrateRoot;const Y=({size:o="md",message:e,className:t=""})=>{const r={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"};return i.jsxs("div",{className:`flex flex-col items-center justify-center space-y-3 ${t}`,children:[i.jsx("div",{className:`${r[o]} animate-spin`,"data-testid":"loading-spinner",children:i.jsxs("svg",{className:"w-full h-full text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[i.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),i.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),e&&i.jsx("p",{className:"text-sm text-gray-600 animate-pulse",children:e})]})},Ce=({isLoading:o,message:e,children:t,className:r="",overlayClassName:s=""})=>i.jsxs("div",{className:`relative ${r}`,children:[t,o&&i.jsx("div",{className:`absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50 ${s}`,children:i.jsx(Y,{size:"lg",message:e||""})})]}),Ee=({isLoading:o,isRetrying:e,retryCount:t,message:r,className:s=""})=>{if(!o&&!e)return null;const n=()=>e&&t>0?`Retrying... (${t}/3)`:r||(e?"Initializing configurator...":"Loading configurator...");return i.jsxs("div",{className:`flex flex-col items-center justify-center min-h-[400px] space-y-4 ${s}`,children:[i.jsx(Y,{size:"lg",message:n()}),e&&t>0&&i.jsxs("div",{className:"text-sm text-gray-500 text-center",children:[i.jsx("p",{children:"Having trouble connecting to the configurator."}),i.jsx("p",{children:"This usually resolves automatically."})]})]})};class De extends x.Component{constructor(t){super(t);C(this,"handleRetry",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t,errorInfo:null}}componentDidCatch(t,r){this.setState({error:t,errorInfo:r}),this.props.onError&&this.props.onError(t,r),process.env.NODE_ENV==="development"&&console.error("ErrorBoundary caught an error:",t,r)}render(){var t;return this.state.hasError?this.props.fallback?this.props.fallback:i.jsx("div",{className:`flex flex-col items-center justify-center min-h-[400px] p-6 text-center ${this.props.className||""}`,children:i.jsxs("div",{className:"max-w-md",children:[i.jsx("div",{className:"mb-4",children:i.jsx("svg",{className:"w-16 h-16 mx-auto text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),i.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Something went wrong"}),i.jsx("p",{className:"text-gray-600 mb-4",children:"The configurator encountered an unexpected error. Please try refreshing the page."}),process.env.NODE_ENV==="development"&&this.state.error&&i.jsxs("details",{className:"mb-4 text-left",children:[i.jsx("summary",{className:"cursor-pointer text-sm text-gray-500 hover:text-gray-700",children:"Error Details"}),i.jsxs("pre",{className:"mt-2 text-xs text-red-600 bg-red-50 p-2 rounded overflow-auto",children:[this.state.error.toString(),(t=this.state.errorInfo)==null?void 0:t.componentStack]})]}),i.jsxs("div",{className:"space-x-3",children:[i.jsx("button",{onClick:this.handleRetry,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"Try Again"}),i.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",children:"Refresh Page"})]})]})}):this.props.children}}const Ne=({error:o,isRetrying:e,retryCount:t,onRetry:r,className:s=""})=>{if(!o)return null;const n=()=>e?`Retrying... (${t}/3)`:o,c=(()=>o.includes("Invalid workspaceID")||o.includes("Invalid productID")?"configuration":o.includes("Network")||o.includes("timeout")?"network":o.includes("3D viewer script failed to load")?"script":"general")(),f=()=>{switch(c){case"configuration":return i.jsx("svg",{className:"w-16 h-16 mx-auto text-yellow-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})});case"network":return i.jsx("svg",{className:"w-16 h-16 mx-auto text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192L5.636 18.364M12 2.25a9.75 9.75 0 100 19.5 9.75 9.75 0 000-19.5z"})});case"script":return i.jsxs("svg",{className:"w-16 h-16 mx-auto text-orange-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]});default:return i.jsx("svg",{className:"w-16 h-16 mx-auto text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}},a=()=>{switch(c){case"configuration":return"Configuration Error";case"network":return"Connection Error";case"script":return"3D Viewer Error";default:return"Configurator Error"}},g=()=>{switch(c){case"configuration":return"The workspace or product ID is invalid. Please check your configuration.";case"network":return"Unable to connect to the configurator service. Please check your internet connection.";case"script":return"The 3D viewer failed to load. This may be due to browser compatibility or network issues.";default:return"An unexpected error occurred while loading the configurator."}};return i.jsx("div",{className:`flex flex-col items-center justify-center min-h-[400px] p-6 text-center ${s}`,children:i.jsxs("div",{className:"max-w-md",children:[i.jsx("div",{className:"mb-4",children:f()}),i.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:a()}),i.jsx("p",{className:"text-gray-600 mb-4",children:g()}),i.jsx("div",{className:"text-sm text-gray-500 mb-4",children:n()}),i.jsxs("div",{className:"space-x-3",children:[!e&&i.jsx("button",{onClick:r,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"Try Again"}),i.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",children:"Refresh Page"})]})]})})};var X=(o=>(o[o.DEBUG=0]="DEBUG",o[o.INFO=1]="INFO",o[o.WARN=2]="WARN",o[o.ERROR=3]="ERROR",o))(X||{});class je{constructor(e={}){C(this,"config");C(this,"logs",[]);this.config=m({level:process.env.NODE_ENV==="development"?0:2,enableConsole:!0,enableStorage:process.env.NODE_ENV==="development",maxStorageEntries:1e3,categories:["API","CONFIGURATOR","ERROR","DEBUG"]},e)}shouldLog(e,t){return e>=this.config.level&&this.config.categories.includes(t)}createLogEntry(e,t,r,s,n){return m({timestamp:new Date().toISOString(),level:e,category:t,message:r,data:s},n&&{context:n})}log(e,t,r,s,n){if(!this.shouldLog(e,t))return;const l=this.createLogEntry(e,t,r,s,n);if(this.config.enableStorage&&(this.logs.push(l),this.logs.length>this.config.maxStorageEntries&&this.logs.shift()),this.config.enableConsole){const c=X[e],f=`[${l.timestamp}] [${c}] [${t}]`;console.log(n?`${f} [${n}] ${r}`:`${f} ${r}`,s||"")}}debug(e,t,r,s){this.log(0,e,t,r,s)}info(e,t,r,s){this.log(1,e,t,r,s)}warn(e,t,r,s){this.log(2,e,t,r,s)}error(e,t,r,s){this.log(3,e,t,r,s)}apiCall(e,t,r,s){this.debug("API",`API Call: ${e} ${t}`,{params:r},s)}apiResponse(e,t,r,s,n){const l=r>=400?3:0;this.log(l,"API",`API Response: ${e} ${t} (${r})`,{response:s},n)}apiError(e,t,r,s){this.error("API",`API Error: ${e} ${t}`,{error:r.message,stack:r.stack},s)}configuratorInit(e,t){this.info("CONFIGURATOR","Configurator initialization started",{params:e},t)}configuratorReady(e,t,r){this.info("CONFIGURATOR","Configurator ready",{options:e.length,selections:Object.keys(t).length},r)}configuratorError(e,t){this.error("CONFIGURATOR","Configurator error",{error:e.message,stack:e.stack},t)}getLogs(e,t){let r=this.logs;return e&&(r=r.filter(s=>s.category===e)),t!==void 0&&(r=r.filter(s=>s.level>=t)),r}clearLogs(){this.logs=[]}exportLogs(){return JSON.stringify(this.logs,null,2)}updateConfig(e){this.config=m(m({},this.config),e)}}const d=new je;function Ae(o,e,t,r){d.apiCall(o,e,t,r)}function Pe(o,e,t,r,s){d.apiResponse(o,e,t,r,s)}function Le(o,e){d.configuratorInit(o,e)}function $e(o,e,t){d.configuratorReady(o,e,t)}function Oe(o,e){d.configuratorError(o,e)}const J={workspaceID:"demo-workspace",productID:"demo-product",host:"https://embodee.com",width:"100%",height:"600px",variant:"Master",designID:"false"},Fe={development:{workspaceID:"dev-workspace",productID:"dev-product",host:"https://dev.embodee.com"},staging:{workspaceID:"staging-workspace",productID:"staging-product",host:"https://staging.embodee.com"},production:{workspaceID:"prod-workspace",productID:"prod-product",host:"https://embodee.com"}};class Se{constructor(e={}){C(this,"config");C(this,"strategy");this.strategy=m({useEnvironmentDefaults:!0,useLocalStorage:!0,useQueryParams:!0,useHardcodedDefaults:!0},e),this.config=m({},J),this.loadFallbackConfig()}loadFallbackConfig(){if(d.debug("FALLBACK","Loading fallback configuration",{strategy:this.strategy},"FallbackConfigManager"),this.strategy.useEnvironmentDefaults){const e=process.env.NODE_ENV||"development",t=Fe[e];t&&(this.config=m(m({},this.config),t),d.debug("FALLBACK","Applied environment defaults",{env:e,config:t},"FallbackConfigManager"))}if(this.strategy.useLocalStorage&&typeof window!="undefined")try{const e=localStorage.getItem("embodee-fallback-config");if(e){const t=JSON.parse(e);this.config=m(m({},this.config),t),d.debug("FALLBACK","Applied localStorage defaults",{config:t},"FallbackConfigManager")}}catch(e){d.warn("FALLBACK","Failed to parse localStorage config",{error:e.message},"FallbackConfigManager")}if(this.strategy.useQueryParams&&typeof window!="undefined"){const e=new URLSearchParams(window.location.search),t={};e.has("defaultWorkspace")&&(t.workspaceID=e.get("defaultWorkspace")),e.has("defaultProduct")&&(t.productID=e.get("defaultProduct")),e.has("defaultHost")&&(t.host=e.get("defaultHost")),Object.keys(t).length>0&&(this.config=m(m({},this.config),t),d.debug("FALLBACK","Applied query parameter defaults",{config:t},"FallbackConfigManager"))}}getConfig(){return m({},this.config)}updateConfig(e){if(this.config=m(m({},this.config),e),d.info("FALLBACK","Fallback configuration updated",{config:e},"FallbackConfigManager"),this.strategy.useLocalStorage&&typeof window!="undefined")try{localStorage.setItem("embodee-fallback-config",JSON.stringify(this.config)),d.debug("FALLBACK","Configuration saved to localStorage",{},"FallbackConfigManager")}catch(t){d.warn("FALLBACK","Failed to save to localStorage",{error:t.message},"FallbackConfigManager")}}applyFallbacks(e){const t={workspaceID:e.workspaceID||this.config.workspaceID,productID:e.productID||this.config.productID,host:e.host||this.config.host,width:e.width||this.config.width,height:e.height||this.config.height,variant:e.variant||this.config.variant,designID:e.designID||this.config.designID};return d.debug("FALLBACK","Applied fallbacks to parameters",{original:e,result:t,fallbacks:this.config},"FallbackConfigManager"),t}validateConfig(){const e=[];(!this.config.workspaceID||this.config.workspaceID.trim()==="")&&e.push("workspaceID is required"),(!this.config.productID||this.config.productID.trim()==="")&&e.push("productID is required"),(!this.config.host||this.config.host.trim()==="")&&e.push("host is required");try{new URL(this.config.host)}catch(r){e.push("host must be a valid URL")}const t=e.length===0;return t?d.debug("FALLBACK","Configuration validation passed",{},"FallbackConfigManager"):d.warn("FALLBACK","Configuration validation failed",{errors:e},"FallbackConfigManager"),{isValid:t,errors:e}}reset(){this.config=m({},J),this.loadFallbackConfig(),d.info("FALLBACK","Configuration reset to defaults",{},"FallbackConfigManager")}getSummary(){const e=[];return this.strategy.useEnvironmentDefaults&&e.push("environment"),this.strategy.useLocalStorage&&e.push("localStorage"),this.strategy.useQueryParams&&e.push("queryParams"),this.strategy.useHardcodedDefaults&&e.push("hardcoded"),{config:this.config,strategy:this.strategy,validation:this.validateConfig(),sources:e}}}const Te=new Se;function Ue(o){return Te.applyFallbacks(o)}function Me(o){const e=o||(typeof window!="undefined"?window.location.href:""),r=new URL(e).searchParams;d.debug("URL_PARAMS","Parsing URL parameters",{url:e},"parseUrlParams");const s=r.has("workspaceID")||r.has("workspace"),n=r.has("productID")||r.has("product"),l=r.get("workspaceID")||r.get("workspace"),c=r.get("productID")||r.get("product"),f=r.get("variant")||void 0,a=r.get("designID")||r.get("design")||void 0,g=r.get("host")||void 0,y=r.get("width")||void 0,w=r.get("height")||void 0,I={};l&&(I.workspaceID=l),c&&(I.productID=c),f&&(I.variant=f),a&&(I.designID=a),g&&(I.host=g),y&&(I.width=y),w&&(I.height=w);const R=Ue(I);return d.info("URL_PARAMS","URL parameters parsed successfully",{hasWorkspaceID:s,hasProductID:n,parsedParams:I,finalParams:R,fallbacksUsed:{workspaceID:!s,productID:!n,host:!g,width:!y,height:!w}},"parseUrlParams"),R}function _e(o){return!o.workspaceID||o.workspaceID.trim()===""?{isValid:!1,error:"workspaceID is required"}:!o.productID||o.productID.trim()===""?{isValid:!1,error:"productID is required"}:/^[a-zA-Z0-9_-]+$/.test(o.workspaceID)?/^[a-zA-Z0-9_-]+$/.test(o.productID)?o.variant&&!/^[a-zA-Z0-9_-]+$/.test(o.variant)?{isValid:!1,error:"variant contains invalid characters"}:o.designID&&!/^[a-zA-Z0-9_-]+$/.test(o.designID)?{isValid:!1,error:"designID contains invalid characters"}:{isValid:!0}:{isValid:!1,error:"productID contains invalid characters"}:{isValid:!1,error:"workspaceID contains invalid characters"}}function ze(o){const e=Me(o),t=_e(e);if(!t.isValid)throw new Error(`Invalid URL parameters: ${t.error}`);return e}class D extends Error{constructor(t,r=0,s=0,n){super(t);C(this,"code");C(this,"status");C(this,"response");this.name="ApiError",this.code=r,this.status=s,this.response=n}}const Ve={baseUrl:"https://embodee.app",timeout:3e4,maxRetries:3,retryDelay:1e3};class We{constructor(e={}){C(this,"config");this.config=m(m({},Ve),e)}getProductData(e,t,r="Master",s="false"){return E(this,null,function*(){var l,c,f;const n=this.buildProductDataUrl(e,t,r,s);Ae("GET",n,{workspaceID:e,productID:t,variant:r,designID:s},"getProductData");try{const a=yield this.fetchWithRetry(n),g=yield a.json();if(Pe("GET",n,a.status,g,"getProductData"),g.status!=="ok"){const y=new D(`API Error: ${g.message}`,g.errorcode,a.status,g);throw d.error("API","getProductData error",{error:y.message},"getProductData"),y}return d.info("API","Product data fetched successfully",{workspaceID:e,productID:t,variant:r,designID:s,hasConfig:!!((l=g.result)!=null&&l.config),hasUI:!!((c=g.result)!=null&&c.ui),hasLibrary:!!((f=g.result)!=null&&f.library)},"getProductData"),g.result}catch(a){if(a instanceof D)throw a;const g=new D(`Failed to fetch product data: ${a instanceof Error?a.message:"Unknown error"}`,0,0,a);throw d.error("API","getProductData error",{error:g.message},"getProductData"),g}})}getProductDataFromParams(e){return E(this,null,function*(){const{workspaceID:t,productID:r,variant:s="Master",designID:n="false"}=e;return this.getProductData(t,r,s,n)})}getLibraryData(e){return E(this,null,function*(){const t=`${this.config.baseUrl}/configurator/get-library/${e}`;try{const r=yield this.fetchWithRetry(t),s=yield r.json();if(s.status!=="ok")throw new D(`API Error: ${s.message}`,s.errorcode,r.status,s);return s.result}catch(r){throw r instanceof D?r:new D(`Failed to fetch library data: ${r instanceof Error?r.message:"Unknown error"}`,0,0,r)}})}buildProductDataUrl(e,t,r,s){return`${this.config.baseUrl}/configurator/get-data/${e}/${t}/${r}/${s}`}fetchWithRetry(r){return E(this,arguments,function*(e,t={}){var n;let s=null;d.debug("API",`Starting fetch with retry for ${e}`,{maxRetries:this.config.maxRetries,timeout:this.config.timeout},"fetchWithRetry");for(let l=1;l<=this.config.maxRetries;l++)try{d.debug("API",`Fetch attempt ${l}/${this.config.maxRetries}`,{url:e},"fetchWithRetry");const c=new AbortController,f=setTimeout(()=>{d.warn("API",`Request timeout after ${this.config.timeout}ms`,{url:e},"fetchWithRetry"),c.abort()},this.config.timeout),a=yield fetch(e,W(m({},t),{signal:c.signal,headers:m({"Content-Type":"application/json",Accept:"application/json"},t.headers)}));if(clearTimeout(f),d.debug("API","Response received",{url:e,status:a.status,statusText:a.statusText,headers:Object.fromEntries(a.headers.entries())},"fetchWithRetry"),!a.ok){const g=new D(`HTTP ${a.status}: ${a.statusText}`,0,a.status,a);throw d.warn("API","HTTP error response",{url:e,status:a.status,statusText:a.statusText},"fetchWithRetry"),g}return d.info("API","Request successful",{url:e,status:a.status},"fetchWithRetry"),a}catch(c){if(s=c instanceof Error?c:new Error("Unknown error"),d.warn("API",`Request failed (attempt ${l}/${this.config.maxRetries})`,{url:e,error:s.message,errorType:((n=c.constructor)==null?void 0:n.name)||"Unknown"},"fetchWithRetry"),c instanceof D&&c.status>=400&&c.status<500)throw d.error("API","Client error - not retrying",{url:e,status:c.status,message:c.message},"fetchWithRetry"),c;if(l<this.config.maxRetries){const f=this.config.retryDelay*l;d.info("API",`Retrying in ${f}ms`,{url:e,attempt:l,maxRetries:this.config.maxRetries,delay:f},"fetchWithRetry"),yield this.delay(f)}}throw d.error("API","Max retries exceeded",{url:e,maxRetries:this.config.maxRetries,lastError:s==null?void 0:s.message},"fetchWithRetry"),s||new Error("Max retries exceeded")})}delay(e){return new Promise(t=>setTimeout(t,e))}updateConfig(e){this.config=m(m({},this.config),e)}getConfig(){return m({},this.config)}}const Be=new We;function N(o,e="API Call"){process.env.NODE_ENV==="development"&&(console.error(`[${e}]`,o),o instanceof D&&console.error("API Error Details:",{message:o.message,code:o.code,status:o.status,response:o.response}))}const Ge=o=>{const e=[],t={},r=s=>{var n;if(s.type==="decal"&&s.subtype==="text"&&((n=s.props)!=null&&n.text)){const l=s.props.text,c={type:"text",id:s.code,name:s.name,text:{propName:"",label:"",value:""}};for(const f in l){const a=l[f];if(!a||a.dynamic===!1)continue;const g=`${s.code}:${f}`;if(a.type==="text")c.text={propName:f,label:a.label,value:a.value},t[g]=a.value;else if(a.type==="list"&&a.items){const y=Object.values(a.items);if(y.length>0){const w=f.toLowerCase().includes("color"),I={id:g,name:a.label,values:y.map(R=>({id:R.id,name:R.name,color:w?`#${R.value}`:null,thumbnailUrl:null}))};f.toLowerCase().includes("font")?c.font=I:w&&(c.color=I),a.value&&(t[g]=a.value)}}}c.text.propName&&e.push(c)}else if(s.props)for(const l in s.props){const c=s.props[l];if(c&&typeof c.items=="function"){const f=c.items(),a=Object.values(f);if(a.length>0){const g=`${s.code}:${l}`;e.push({id:g,name:`${s.name} ${l.charAt(0).toUpperCase()+l.slice(1)}`,values:a.map(y=>({id:y.id,name:y.name,color:l==="color"?`#${y.value}`:null,thumbnailUrl:l==="material"?y.value:null}))}),c.value&&(t[g]=c.value)}}}s.children&&s.children.forEach(r)};return o.forEach(r),{options:e,selections:t}},ee=()=>{const[o,e]=x.useState(!0),[t,r]=x.useState(null),[s,n]=x.useState(null),[l,c]=x.useState(null),[f,a]=x.useState([]),[g,y]=x.useState({}),[w,I]=x.useState(!1),[R,U]=x.useState(0),[O,M]=x.useState(!1),P=x.useRef(null),_=x.useRef(!1),j=x.useRef(null),L=x.useCallback((u=!1)=>E($,null,function*(){if(!(_.current&&!u)){u||(_.current=!0);try{e(!0),r(null),M(u);const p=ze();Le(p,`useEmbodee (attempt ${R+1})`),d.debug("CONFIGURATOR","Waiting for EmbodeeLoader",{},"useEmbodee"),yield te(),d.info("CONFIGURATOR","EmbodeeLoader is available",{},"useEmbodee"),d.debug("CONFIGURATOR","Fetching product data",{urlParams:p},"useEmbodee");const h=yield re(p);c(h),d.info("CONFIGURATOR","Product data fetched successfully",{hasConfig:!!(h!=null&&h.config),hasUI:!!(h!=null&&h.ui),hasLibrary:!!(h!=null&&h.library)},"useEmbodee"),d.debug("CONFIGURATOR","Initializing 3D viewer",{urlParams:p},"useEmbodee");const b=yield se(p,h);n(b),P.current=b,d.info("CONFIGURATOR","3D viewer initialized successfully",{},"useEmbodee"),ne(b),U(0),M(!1)}catch(p){const h=p instanceof Error?p.message:"Failed to initialize configurator";if(oe(p,R)&&R<3){const v=R+1;U(v),N(p,`useEmbodee initialization failed (attempt ${v}), retrying in ${G(v)}ms`),j.current=setTimeout(()=>{L(!0)},G(v)),r(`Initialization failed, retrying... (${v}/3)`)}else r(h),N(p,"useEmbodee initialization - max retries exceeded"),M(!1)}finally{O||e(!1)}}}),[R,O]),te=()=>new Promise((u,p)=>{let b=0;const v=setInterval(()=>{var A;typeof window!="undefined"&&typeof((A=window.EmbodeeLoader)==null?void 0:A.init)=="function"?(clearInterval(v),u()):++b>150&&(clearInterval(v),p(new Error("The 3D viewer script failed to load in time.")))},200)}),re=u=>E($,null,function*(){try{return yield Be.getProductDataFromParams(u)}catch(p){throw N(p,"fetchProductDataWithRetry"),p}}),se=(u,p)=>E($,null,function*(){try{return yield ie(u,p)}catch(h){throw N(h,"initializeViewerWithRetry"),h}}),oe=(u,p)=>{var h,b,v;return!(p>=3||(h=u==null?void 0:u.message)!=null&&h.includes("Invalid workspaceID")||(b=u==null?void 0:u.message)!=null&&b.includes("Invalid productID")||(v=u==null?void 0:u.message)!=null&&v.includes("Product not found"))},G=u=>Math.min(1e3*Math.pow(2,u-1),1e4),ie=(u,p)=>E($,null,function*(){return yield window.EmbodeeLoader.init({containerID:"embodee-configurator",workspaceID:u.workspaceID,productCode:u.productID,variant:u.variant||"Master",designID:u.designID||"false",width:u.width||"100%",height:u.height||"600px",host:u.host||"https://embodee.app"})}),ne=u=>{d.debug("CONFIGURATOR","Setting up viewer events",{},"useEmbodee");const p=()=>{try{d.debug("CONFIGURATOR","Product ready event received",{},"useEmbodee");const{options:h,selections:b}=Ge(u.uiStructure);a(h),y(b),I(!0),$e(h,b,"useEmbodee"),d.info("CONFIGURATOR","Product ready - UI structure parsed successfully",{optionsCount:h.length,selectionsCount:Object.keys(b).length,optionTypes:h.map(v=>v.type||"unknown")},"useEmbodee")}catch(h){Oe(h,"Product ready handler"),r("Failed to parse product options")}};u.subscribe(u.eventIDs.productReady,p),d.info("CONFIGURATOR","Viewer events subscribed successfully",{},"useEmbodee")},ae=x.useCallback((u,p,h,b=!1)=>E($,null,function*(){const v=P.current;if(!v||!w)throw new Error("Configurator not ready");const A=3;let F=null;for(let S=1;S<=A;S++)try{yield v.setComponentValue(u,p,h,b);const k=`${u}:${p}`;y(z=>W(m({},z),{[k]:h})),t&&t.includes("setValue")&&r(null);return}catch(k){if(F=k instanceof Error?k:new Error("Unknown error"),k instanceof Error&&(k.message.includes("Invalid component")||k.message.includes("Invalid property")||k.message.includes("Invalid value")))throw k;S<A&&(N(k,`setValue retry ${S}/${A}: ${u}:${p}`),yield new Promise(z=>setTimeout(z,500*S)))}const K=`Failed to set value after ${A} attempts: ${F==null?void 0:F.message}`;throw N(F,`setValue failed: ${u}:${p}`),r(K),new Error(K)}),[w,t]),ce=x.useCallback((u,p)=>{const h=P.current;if(!h||!w)return"";try{return h.getComponentValue(u,p)}catch(b){return N(b,`getValue: ${u}:${p}`),""}},[w]),le=x.useCallback(()=>{const u=P.current;if(!u||!w)return g;try{return u.getCurrentSelections()}catch(p){return N(p,"getSelections"),g}},[w,g]);x.useEffect(()=>{L()},[L]);const ue=x.useCallback(()=>{O||(j.current&&(clearTimeout(j.current),j.current=null),_.current=!1,U(0),r(null),L())},[O,L]);return x.useEffect(()=>()=>{j.current&&(clearTimeout(j.current),j.current=null),P.current&&(P.current=null)},[]),{configurator:s,isLoading:o,error:t,initialize:L,setValue:ae,getValue:ce,getSelections:le,productData:l,options:f,selections:g,isInitialized:w,retry:ue,retryCount:R,isRetrying:O}},Ke=({children:o,className:e="",showRetryButton:t=!0,onError:r})=>{const{isLoading:s,error:n,isRetrying:l,retryCount:c,retry:f,isInitialized:a}=ee(),g=(y,w)=>{console.error("ConfiguratorWrapper caught an error:",y,w),r&&r(y,w)};return s||l?i.jsx(Ee,{isLoading:s,isRetrying:l,retryCount:c,className:e}):n?i.jsx(Ne,{error:n,isRetrying:l,retryCount:c,onRetry:f,className:e}):i.jsx(De,{onError:g,className:e,children:i.jsx(Ce,{isLoading:!a,message:"Initializing 3D viewer...",className:"min-h-[400px]",children:o})})};function qe(){const{isLoading:o,error:e,isInitialized:t}=ee();return i.jsx("div",{className:"min-h-screen bg-gray-50",children:i.jsxs("div",{className:"container mx-auto px-4 py-8",children:[i.jsxs("header",{className:"text-center mb-8",children:[i.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"Embodee Product Configurator"}),i.jsx("p",{className:"text-lg text-gray-600",children:"Modern React + TypeScript + Vite + Tailwind CSS"})]}),i.jsx("main",{className:"max-w-4xl mx-auto",children:i.jsx(Ke,{children:i.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8",children:[i.jsx("h2",{className:"text-2xl font-semibold text-gray-800 mb-4",children:"Configurator Status"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx("div",{className:`w-3 h-3 rounded-full ${o?"bg-yellow-500":"bg-green-500"}`}),i.jsx("span",{className:"text-sm font-medium",children:o?"Loading...":"Ready"})]}),e&&i.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:i.jsx("p",{className:"text-red-800 text-sm",children:e})}),t&&i.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:i.jsx("p",{className:"text-green-800 text-sm",children:"âœ… Configurator initialized successfully!"})})]}),i.jsxs("div",{className:"mt-8 p-6 bg-gray-50 rounded-lg",children:[i.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-3",children:"Test URL Parameters"}),i.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Add these parameters to test the configurator:"}),i.jsx("div",{className:"bg-white p-4 rounded border font-mono text-sm",children:"?workspaceID=demo-workspace&productID=demo-product&variant=Master"})]})]})})}),i.jsxs("footer",{className:"text-center mt-12 text-gray-500 text-sm",children:[i.jsx("p",{children:"Built with React, TypeScript, Vite, and Tailwind CSS"}),i.jsx("p",{children:"Deployed on GitHub Pages"})]})]})})}B.createRoot(document.getElementById("root")).render(i.jsx(ye.StrictMode,{children:i.jsx(qe,{})}))});export default He();
//# sourceMappingURL=index-afcc11ed.js.map
